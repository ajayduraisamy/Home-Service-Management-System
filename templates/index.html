{% extends "base.html" %}
{% block content %}

<section class="hero position-relative overflow-hidden py-5 bg-light">
    <div class="container">
        <h1 class="text-center mb-5 display-4 fw-bold text-dark"> Services</h1>

        <div id="servicesCarousel" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner">
                {% set chunk_size = 4 %}
                {% for i in range(0, services|length, chunk_size) %}
                <div class="carousel-item {% if i == 0 %}active{% endif %}">
                    <div class="row justify-content-center g-4">
                        {% for service in services[i:i+chunk_size] %}
                        <div class="col-lg-3 col-md-6 mb-4">
                            <div class="card service-card shadow-lg h-100 border-0 rounded-4 overflow-hidden">
                                <div class="service-image-container" style="height: 200px;">
                                    <img src="{{ url_for('static', filename='profiles/' ~ service.image_file) }}"
                                        class="service-image w-100 h-100" alt="{{ service.name }}"
                                        style="object-fit: cover;">
                                </div>
                                <div class="card-body service-card-body d-flex flex-column p-4">
                                    <h5 class="card-title fw-bold text-dark">{{ service.name }}</h5>
                                    <p class="card-text text-muted flex-grow-1">{{ service.description }}</p>
                                    <div class="mt-auto">
                                        <p class="mb-1"><strong class="text-primary">Provider:</strong> {{
                                            service.provider_name }}</p>
                                        <p class="mb-3"><strong class="text-primary">Price:</strong> Rs.{{ service.price
                                            }}</p>
                                        <button class="btn btn-primary w-100 rounded-pill py-2 fw-bold"
                                            data-bs-toggle="modal" data-bs-target="#bookingModal{{ service.id }}">Book
                                            Now</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Booking Modal -->
                        <div class="modal fade" id="bookingModal{{ service.id }}" tabindex="-1"
                            aria-labelledby="bookingModalLabel{{ service.id }}" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content rounded-4 shadow-lg">
                                    <form action="{{ url_for('book_service', service_id=service.id) }}" method="POST"
                                        id="bookingForm{{ service.id }}">
                                        <div class="modal-header bg-gradient-primary text-white rounded-top-4">
                                            <h5 class="modal-title fw-bold" id="bookingModalLabel{{ service.id }}">Book
                                                {{ service.name }}</h5>
                                            <button type="button" class="btn-close btn-close-white"
                                                data-bs-dismiss="modal" aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body p-4">
                                            <div class="mb-4 text-center">
                                                <img src="{{ url_for('static', filename='profiles/' ~ service.image_file) }}"
                                                    class="rounded-3 mb-3" alt="{{ service.name }}"
                                                    style="width: 100%; height: 150px; object-fit: cover;">
                                                <h5 class="fw-bold">{{ service.name }}</h5>
                                                <p class="text-muted">{{ service.provider_name }} â€¢ Rs.{{ service.price
                                                    }}</p>
                                            </div>

                                            <div class="mb-4">
                                                <label for="bookingDate{{ service.id }}"
                                                    class="form-label fw-semibold">Select Date</label>
                                                <div class="input-group">
                                                    <span class="input-group-text bg-primary text-white">
                                                        <i class="fas fa-calendar-alt"></i>
                                                    </span>
                                                    <input type="date" class="form-control rounded-end"
                                                        id="bookingDate{{ service.id }}" name="booking_date" required
                                                        min="{{ today }}">
                                                </div>
                                                <small class="form-text text-muted">Select your preferred service
                                                    date</small>
                                            </div>

                                            <div class="mb-4">
                                                <label class="form-label fw-semibold">Payment Details</label>
                                                <div class="mb-3">
                                                    <label for="card_number{{ service.id }}" class="form-label">Card
                                                        Number</label>
                                                    <input type="text" class="form-control"
                                                        id="card_number{{ service.id }}" name="card_number" required
                                                        pattern="\d{16}" placeholder="1234 5678 9012 3456">
                                                </div>
                                                <div class="row g-2">
                                                    <div class="col-md-6">
                                                        <label for="expiry{{ service.id }}" class="form-label">Expiry
                                                            (MM/YY)</label>
                                                        <input type="text" class="form-control"
                                                            id="expiry{{ service.id }}" name="expiry" required
                                                            pattern="(0[1-9]|1[0-2])\/\d{2}" placeholder="MM/YY">
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label for="cvv{{ service.id }}" class="form-label">CVV</label>
                                                        <input type="text" class="form-control" id="cvv{{ service.id }}"
                                                            name="cvv" required pattern="\d{3}" placeholder="123">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="modal-footer border-0">
                                            <button type="button" class="btn btn-outline-secondary rounded-pill px-4"
                                                data-bs-dismiss="modal">Cancel</button>
                                            <button type="submit"
                                                class="btn btn-primary rounded-pill px-4 fw-bold">Confirm
                                                Booking</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Carousel controls -->
            <button class="carousel-control-prev" type="button" data-bs-target="#servicesCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon bg-primary rounded-circle p-3" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#servicesCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon bg-primary rounded-circle p-3" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>
    </div>
</section>

<style>
    .hero {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    }

    .service-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        overflow: hidden;
    }

    .service-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 1rem 3rem rgba(0, 0, 0, 0.175) !important;
    }

    .service-image-container {
        overflow: hidden;
    }

    .service-image {
        transition: transform 0.5s ease;
    }

    .service-card:hover .service-image {
        transform: scale(1.05);
    }

    .carousel-control-prev,
    .carousel-control-next {
        width: 5%;
        opacity: 0.8;
    }

    .bg-gradient-primary {
        background: linear-gradient(135deg, #4e73df 0%, #224abe 100%) !important;
    }

    /* Custom date picker styling */
    input[type="date"] {
        padding: 0.75rem;
    }

    input[type="date"]::-webkit-calendar-picker-indicator {
        cursor: pointer;
        border-radius: 4px;
        padding: 0.25rem;
        background-color: #4e73df;
        color: white;
    }

    /* Form control focus effects */
    .form-control:focus {
        border-color: #4e73df;
        box-shadow: 0 0 0 0.2rem rgba(78, 115, 223, 0.25);
    }
</style>

<!-- Font Awesome for icons -->
<script src="https://kit.fontawesome.com/your-font-awesome-kit.js" crossorigin="anonymous"></script>

<script>
    // Set minimum date to today for all date inputs
    document.addEventListener('DOMContentLoaded', function () {
        const today = new Date().toISOString().split('T')[0];
        const dateInputs = document.querySelectorAll('input[type="date"]');

        dateInputs.forEach(input => {
            input.setAttribute('min', today);
        });

        // Add input formatting for card number, expiry, and CVV
        const cardNumberInputs = document.querySelectorAll('input[name="card_number"]');
        cardNumberInputs.forEach(input => {
            input.addEventListener('input', function (e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length > 16) value = value.slice(0, 16);
                e.target.value = value.replace(/(\d{4})/g, '$1 ').trim();
            });
        });

        const expiryInputs = document.querySelectorAll('input[name="expiry"]');
        expiryInputs.forEach(input => {
            input.addEventListener('input', function (e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length > 4) value = value.slice(0, 4);
                if (value.length > 2) {
                    value = value.slice(0, 2) + '/' + value.slice(2);
                }
                e.target.value = value;
            });
        });
    });
</script>

{% endblock %}